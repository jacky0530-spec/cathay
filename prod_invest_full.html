<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹æ³°äººå£½æœˆæœˆæ»¿æº¢ - é…æ¯æ¨¡æ“¬è©¦ç®—</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1100px; /* åŠ å¯¬ä»¥å®¹ç´åˆ†é–‹é¡¯ç¤ºçš„æ¬„ä½ */
            margin: 0 auto;
            background-color: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-top: 6px solid #00994e;
            position: relative;
        }
        
        h1 {
            color: #00994e;
            text-align: center;
            font-size: 26px;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .input-panel {
            background-color: #f8fcf9;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #444;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
            background-color: white;
        }
        .input-group input:focus, .input-group select:focus {
            border-color: #00994e;
            outline: none;
        }

        button.calc-btn {
            width: 100%;
            padding: 16px;
            background-color: #00994e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button.calc-btn:hover {
            background-color: #007a3e;
        }
        button.calc-btn:active {
            transform: scale(0.98);
        }

        .result-section {
            margin-top: 30px;
            display: block; 
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 900px) {
            .result-grid { grid-template-columns: 1fr; }
        }

        .card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        .card-header {
            font-size: 18px;
            font-weight: bold;
            color: #00994e;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f5e9;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 15px;
        }
        .data-val {
            font-weight: bold;
            color: #2c3e50;
        }
        .highlight-val {
            color: #d32f2f;
            font-size: 1.1em;
        }

        /* é…æ¯ç´šè·è¡¨æ¨£å¼ */
        .table-container {
            overflow-x: auto;
        }
        .payout-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
            min-width: 800px;
        }
        .payout-table th, .payout-table td {
            border: 1px solid #e0e0e0;
            padding: 10px;
            text-align: center;
        }
        .payout-table th {
            background-color: #f5f5f5;
            color: #666;
            font-weight: bold;
            white-space: nowrap;
        }
        /* ç‰¹åˆ¥å¼·èª¿å¹´åº¦é…æ¯æ¬„ä½ */
        .th-annual, .td-annual {
            background-color: #fff8e1;
            border-left: 2px solid #ffecb3;
        }
        .th-annual {
            color: #b38600 !important;
        }
        
        .payout-table tr.active-row {
            background-color: #e8f5e9;
            border: 2px solid #00994e;
        }
        .payout-table tr.active-row td {
            color: #007a3e;
            font-weight: bold;
        }
        
        .source-note {
            text-align: right;
            font-size: 12px;
            color: #888;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        .warning-box {
            background-color: #fff5f5;
            border: 2px solid #e53e3e;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-top: 40px; 
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(229, 62, 62, 0.2);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(229, 62, 62, 0); }
            100% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0); }
        }
        
        .note-text {
            font-size: 13px;
            color: #d32f2f;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    
    <h1>åœ‹æ³°äººå£½æœˆæœˆæ»¿æº¢ - é…æ¯æ¨¡æ“¬è©¦ç®—(å¯åˆ‡æ›åŸºé‡‘)</h1>
    <div class="subtitle">è¼¸å…¥åƒæ•¸ä»¥é ä¼°é…æ¯èˆ‡è²»ç”¨</div>

    <div class="input-panel">
        <div class="input-group">
            <label for="investTWD">æŠ•å…¥é‡‘é¡ (æ–°å°å¹£)</label>
            <input type="number" id="investTWD" value="1000000">
        </div>
        <div class="input-group">
            <label for="rateUSD">ç¾é‡‘åŒ¯ç‡ (å³æœŸè³£å‡º)</label>
            <input type="number" id="rateUSD" value="31.5" step="0.01">
        </div>
        <div class="input-group">
            <label for="fundSelect">æŠ•è³‡æ¨™çš„ (é…æ¯å¸³æˆ¶)</label>
            <select id="fundSelect" onchange="calculate()">
                <option value="schroder">å§”è¨—æ–½ç¾…å¾· - å¼·ç©é‡‘æˆé•·å‹</option>
                <option value="ab">å§”è¨—è¯åš - å…¨çƒå¤šå…ƒè³‡ç”¢æ”¶ç›Šå‹</option>
            </select>
        </div>
        <div class="input-group">
            <label for="nav">åŸºé‡‘æ·¨å€¼ (USD)</label>
            <input type="number" id="nav" value="10.3" step="0.01">
        </div>
    </div>

    <button type="button" class="calc-btn" id="calcBtn">æ›´æ–°è©¦ç®—çµæœ</button>
    <div class="source-note">åŒ¯ç‡åƒè€ƒï¼šåœ‹æ³°ä¸–è¯éŠ€è¡Œå³æœŸè³£å‡ºåŒ¯ç‡</div>

    <div id="resultSection" class="result-section">
        <div class="result-grid">
            <div class="card">
                <div class="card-header">ğŸ“Š æŠ•è³‡æ˜ç´°</div>
                <div class="data-row">
                    <span>åŸå§‹æŠ•å…¥ï¼š</span>
                    <span class="data-val" id="dispTWD">1,000,000 å…ƒ</span>
                </div>
                <div class="data-row">
                    <span>æ›ç®—ç¾é‡‘æœ¬é‡‘ï¼š</span>
                    <span class="data-val" id="dispUSD">$31,746.03</span>
                </div>
                <div class="data-row">
                    <span>å–å¾—å–®ä½æ•¸ï¼š</span>
                    <span class="data-val" id="dispUnits">3,082.14 å–®ä½</span>
                </div>
                <div style="margin-top:10px; font-size:13px; color:#666; border-top:1px dashed #ccc; padding-top:8px;">
                    *æœ¬é‡‘æœªæ‰£é™¤ç›¸é—œè²»ç”¨ï¼Œåƒ…åšåŒ¯ç‡æ›ç®—åƒè€ƒã€‚
                </div>
            </div>

            <div class="card" style="border-left: 4px solid #fbc02d;">
                <div class="card-header" style="color: #f57f17;">ğŸ’° è²»ç”¨é ä¼° (å‰3å¹´è¡Œæ”¿è²»)</div>
                <div class="data-row">
                    <span>æ¯æœˆè²»ç‡ï¼š</span>
                    <span class="data-val">0.1% (å¸³æˆ¶åƒ¹å€¼)</span>
                </div>
                <div class="data-row">
                    <span>æ¯å¹´é ä¼°è²»ç”¨ï¼š</span>
                    <span class="data-val" id="feeYearly">12,000 å…ƒ</span>
                </div>
                <div class="data-row" style="background:#fffde7; padding:5px; border-radius:4px;">
                    <span>3å¹´ç¸½è²»ç”¨åˆè¨ˆï¼š</span>
                    <span class="data-val highlight-val" id="feeTotal">36,000 å…ƒ</span>
                </div>
                <div style="margin-top:10px; font-size:13px; color:#666;">
                    *è²»ç”¨ä»¥ç›®å‰æ·¨å€¼ä¼°ç®—ï¼Œå¯¦éš›ä¾æ¯æœˆå¸³æˆ¶åƒ¹å€¼è®Šå‹•ã€‚ç¬¬4å¹´èµ·è¡Œæ”¿è²»ç‚º0%ã€‚
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 20px; border-left: 4px solid #00994e;">
            <div class="card-header">ğŸ’µ é…æ¯æ©Ÿåˆ¶èˆ‡è©¦ç®—</div>
            
            <div class="data-row">
                <span>é¸æ“‡å¸³æˆ¶ï¼š</span>
                <span class="data-val" id="selectedFundName">æ–½ç¾…å¾·</span>
            </div>
            <div class="data-row">
                <span>ç›®å‰æ·¨å€¼ï¼š</span>
                <span class="data-val" style="font-size:1.2em;" id="currentNav">10.3</span>
            </div>
            <div class="data-row">
                <span>ç¬¦åˆç´šè·ï¼š</span>
                <span class="data-val highlight-val" id="matchLevel">--</span>
            </div>
            
            <div class="table-container">
                <table class="payout-table">
                    <thead>
                        <tr>
                            <th width="15%">æ·¨å€¼å€é–“ (USD)</th>
                            <th width="15%">æ¯æœˆæ’¥å› (USD)<br><span style="font-size:12px; font-weight:normal;">(å«å›ºå®š+ä¸å®šæœŸ)</span></th>
                            <th width="15%" class="th-annual">å¹´åº¦åŠ ç¢¼ (USD)<br><span style="font-size:12px; font-weight:normal;">(åƒ…12æœˆ1æ—¥ä¸”é”æ¨™)</span></th>
                            <th width="25%" style="background-color: #e8f5e9; color: #007a3e;">é ä¼°æ¯æœˆé…æ¯ (å°å¹£)<br><span style="font-size:12px; font-weight:normal;">(ä¸å«å¹´åº¦åŠ ç¢¼)</span></th>
                            <th width="25%" class="th-annual">é ä¼°å¹´åº¦åŠ ç¢¼ (å°å¹£)<br><span style="font-size:12px; font-weight:normal;">(åƒ…12æœˆä¸€æ¬¡æ€§)</span></th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        </tbody>
                </table>
            </div>

            <div id="abNote" class="note-text" style="display:none;">
                * æ³¨æ„ï¼šè¯åšå¸³æˆ¶ä¹‹ã€Œå¹´åº¦åŠ ç¢¼æ’¥å› (0.1 USD)ã€åƒ…é™æ–¼æ¯å¹´12æœˆç¬¬ä¸€å€‹è³‡ç”¢è©•åƒ¹æ—¥ï¼Œä¸”ç•¶æ—¥æ·¨å€¼ â‰§ 10.2 æ™‚æ‰æœƒç™¼æ”¾ã€‚é12æœˆæˆ–æ·¨å€¼æœªé”æ¨™å‰‡ä¸ç™¼æ”¾ã€‚
            </div>

            <div style="background-color: #f1f8f6; padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px dashed #00994e;">
                <div class="data-row">
                    <span>ç›®å‰æ·¨å€¼å°æ‡‰ - é ä¼°æ¯æœˆé…æ¯ (å°å¹£)ï¼š</span>
                    <span class="data-val highlight-val" style="font-size:1.3em;" id="monthlyPayoutTWD">0 å…ƒ</span>
                </div>
                <div class="data-row">
                    <span>ç›®å‰æ·¨å€¼å°æ‡‰ - é ä¼°å¹´åŒ–ç¸½é…æ¯ (å°å¹£)ï¼š</span>
                    <span class="data-val highlight-val" style="font-size:1.3em;" id="annualPayoutTotalTWD">0 å…ƒ</span>
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 5px; text-align: right;">
                    (å¹´åŒ–ç¸½é…æ¯ = æ¯æœˆé…æ¯x12 + é ä¼°å¹´åº¦åŠ ç¢¼x1)
                </div>
                <div class="data-row" style="margin-top:10px; border-top:1px solid #ddd; padding-top:10px;">
                    <span>é ä¼°å¹´åŒ–é…æ¯ç‡ (å°å¹£)ï¼š</span>
                    <span class="data-val" id="annualYield">0.00%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="warning-box">
        âš ï¸ è­¦èªï¼šæœ¬è©¦ç®—ç•«é¢åƒ…ä¾›å…§éƒ¨æ•™è‚²è¨“ç·´ï¼Œå¯¦éš›æ•¸å€¼è«‹æŒ‰ç…§ä¿å–®æ¢æ¬¾ç‚ºæº–ã€‚
    </div>
</div>

<script>
    function formatMoney(num) {
        return num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    function formatMoneyUSD(num) {
        return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // å®šç¾©å„æŠ•è³‡å¸³æˆ¶çš„é…æ¯è¦å‰‡
    // monthlyUnit: æ¯æœˆåˆè¨ˆæ’¥å› (å›ºå®š+ä¸å®šæœŸ)
    // annualUnit: å¹´åº¦ç‰¹åˆ¥æ’¥å› (åƒ…ç‰¹å®šæ™‚é–“)
    const fundRules = {
        'schroder': {
            name: 'å§”è¨—æ–½ç¾…å¾· - å¼·ç©é‡‘æˆé•·å‹',
            type: 'monthly_only', // ä¸»è¦æ˜¯æœˆé…
            tiers: [
                { limit: 10.3, text: "â‰§ 10.3", monthlyUnit: 0.12501, annualUnit: 0 },
                { limit: 10.2, text: "10.2 â‰¦ æ·¨å€¼ < 10.3", monthlyUnit: 0.08334, annualUnit: 0 },
                { limit: 8.0, text: "8.0 â‰¦ æ·¨å€¼ < 10.2", monthlyUnit: 0.04167, annualUnit: 0 },
                { limit: 0, text: "< 8.0", monthlyUnit: 0, annualUnit: 0 }
            ]
        },
        'ab': {
            name: 'å§”è¨—è¯åš - å…¨çƒå¤šå…ƒè³‡ç”¢æ”¶ç›Šå‹',
            type: 'hybrid', // æœˆé…+å¹´é…
            tiers: [
                { 
                    limit: 10.2, 
                    text: "â‰§ 10.2", 
                    monthlyUnit: 0.08334, // å›ºå®š0.04167 + æœˆåŠ ç¢¼0.04167
                    annualUnit: 0.1,      // 12æœˆåŠ ç¢¼
                    annualText: "0.1 (12æœˆé™å®š)"
                },
                { 
                    limit: 8.0, 
                    text: "8.0 â‰¦ æ·¨å€¼ < 10.2", 
                    monthlyUnit: 0.04167, // åƒ…å›ºå®š
                    annualUnit: 0,
                    annualText: "-"
                },
                { 
                    limit: 0, 
                    text: "< 8.0", 
                    monthlyUnit: 0, 
                    annualUnit: 0,
                    annualText: "-"
                }
            ]
        }
    };

    function calculate() {
        const twd = parseFloat(document.getElementById('investTWD').value) || 0;
        const rate = parseFloat(document.getElementById('rateUSD').value) || 0;
        const nav = parseFloat(document.getElementById('nav').value) || 0;
        const fundKey = document.getElementById('fundSelect').value;

        if(twd <= 0 || rate <= 0 || nav <= 0) {
            return;
        }

        const usd = twd / rate;
        const units = usd / nav;
        const currentFund = fundRules[fundKey];

        // é¡¯ç¤ºåŸºæœ¬è³‡æ–™
        document.getElementById('dispTWD').innerText = formatMoney(twd) + " å…ƒ";
        document.getElementById('dispUSD').innerText = "$ " + formatMoneyUSD(usd);
        document.getElementById('dispUnits').innerText = formatMoneyUSD(units) + " å–®ä½";
        document.getElementById('selectedFundName').innerText = currentFund.name;
        document.getElementById('currentNav').innerText = nav;

        // é¡¯ç¤ºè¯åšå°ˆå±¬æç¤º
        const abNote = document.getElementById('abNote');
        if (fundKey === 'ab') {
            abNote.style.display = 'block';
        } else {
            abNote.style.display = 'none';
        }

        // è²»ç”¨è¨ˆç®—
        const monthlyFeeUSD = usd * 0.001;
        const yearlyFeeTWD = monthlyFeeUSD * 12 * rate;
        const totalFeeTWD = yearlyFeeTWD * 3;

        document.getElementById('feeYearly').innerText = formatMoney(yearlyFeeTWD) + " å…ƒ";
        document.getElementById('feeTotal').innerText = formatMoney(totalFeeTWD) + " å…ƒ";

        // å‹•æ…‹ç¹ªè£½è¡¨æ ¼
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = ""; 

        let userMonthlyPayoutTWD = 0;
        let userAnnualOneOffTWD = 0;
        let matchText = "";
        let matched = false;

        currentFund.tiers.forEach((tier) => {
            // è¨ˆç®— Monthly TWD
            const monthlyTWD = tier.monthlyUnit * units * rate;
            // è¨ˆç®— Annual One-off TWD
            const annualOneOffTWD = tier.annualUnit * units * rate;

            const tr = document.createElement('tr');
            
            // åˆ¤æ–·ç•¶å‰å€é–“
            let isCurrentRow = false;
            if (!matched) {
                if (nav >= tier.limit) {
                    isCurrentRow = true;
                    matched = true;
                    matchText = tier.text;
                    userMonthlyPayoutTWD = monthlyTWD;
                    userAnnualOneOffTWD = annualOneOffTWD;
                    
                    if (tier.monthlyUnit === 0) matchText += " (ç„¡é…æ¯)";
                    else matchText += " (ç¬¦åˆ)";
                }
            }

            if (isCurrentRow) {
                tr.classList.add('active-row');
            }

            // è™•ç†å¹´åº¦æ¬„ä½é¡¯ç¤ºæ–‡å­—
            let annualDisplay = "-";
            if (fundKey === 'ab') {
                 // è¯åšé¡¯ç¤ºå…·é«”è¦å‰‡æˆ–æ•¸å€¼
                 annualDisplay = tier.annualText || (tier.annualUnit > 0 ? tier.annualUnit : "-");
            } else {
                 annualDisplay = "ä¸é©ç”¨";
            }

            tr.innerHTML = `
                <td>${tier.text}</td>
                <td>${tier.monthlyUnit > 0 ? tier.monthlyUnit.toFixed(5) : '-'}</td>
                <td class="td-annual">${annualDisplay}</td>
                <td style="color: #007a3e;">${monthlyTWD > 0 ? formatMoney(monthlyTWD) : '-'}</td>
                <td class="td-annual" style="color: #b38600; font-weight:bold;">${annualOneOffTWD > 0 ? formatMoney(annualOneOffTWD) : '-'}</td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById('matchLevel').innerText = matchText;

        // è¨ˆç®—ç¸½çµ
        // å¹´åŒ–é…æ¯ç¸½é¡ = (æ¯æœˆé…æ¯ x 12) + (å¹´åº¦ä¸€æ¬¡æ€§é…æ¯ x 1)
        const totalAnnualPayoutTWD = (userMonthlyPayoutTWD * 12) + userAnnualOneOffTWD;
        const yieldRate = (totalAnnualPayoutTWD / twd) * 100;

        document.getElementById('monthlyPayoutTWD').innerText = formatMoney(userMonthlyPayoutTWD) + " å…ƒ";
        document.getElementById('annualPayoutTotalTWD').innerText = formatMoney(totalAnnualPayoutTWD) + " å…ƒ";
        document.getElementById('annualYield').innerText = yieldRate.toFixed(2) + "%";
    }

    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('calcBtn');
        if (btn) {
            btn.addEventListener('click', calculate);
        }
        calculate();
    });
</script>

</body>
</html>