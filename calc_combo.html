<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹ä¿+åœ‹ä¿ é›™å¹´é‡‘è©¦ç®—è¡¨</title>
    <script type="module" src="auth.js"></script>

    <style>
        :root {
            --labor-color: #2980b9;    /* å‹ä¿è— */
            --national-color: #d35400; /* åœ‹ä¿æ©˜ */
            --total-color: #27ae60;    /* ç¸½è¨ˆç¶  */
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
        }

        /* Input Sections */
        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            border-left: 5px solid #333;
            padding-left: 10px;
        }

        .input-group-wrapper {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-card {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            background-color: #fafafa;
            border: 1px solid #eee;
            min-width: 250px;
        }

        .input-card.labor { border-top: 4px solid var(--labor-color); }
        .input-card.national { border-top: 4px solid var(--national-color); }
        .input-card.general { border-top: 4px solid #7f8c8d; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: bold; font-size: 0.9rem; color: #555; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }

        .btn {
            width: 100%;
            padding: 15px;
            background-color: var(--total-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.2rem;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn:hover { background-color: #219150; }

        /* Table Styling */
        #resultArea {
            display: none;
            margin-top: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        th, td {
            padding: 10px 6px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        /* Header Colors */
        th.th-info { background-color: #34495e; color: white; }
        th.th-labor { background-color: var(--labor-color); color: white; }
        th.th-national { background-color: var(--national-color); color: white; }
        th.th-total { background-color: var(--total-color); color: white; }

        tr:nth-child(even) { background-color: #f9f9f9; }
        
        .highlight-row {
            background-color: #e8f6f3 !important;
            font-weight: bold;
            border: 2px solid var(--total-color);
        }

        .money { font-family: 'Courier New', monospace; font-weight: bold; }
        .labor-text { color: var(--labor-color); }
        .national-text { color: var(--national-color); }
        .total-text { color: var(--total-color); font-size: 1.1em; }

        .note {
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
            background: #f4f4f4;
            padding: 15px;
            border-radius: 6px;
            line-height: 1.6;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>å‹ä¿ + åœ‹ä¿ é›™å¹´é‡‘è©¦ç®—</h1>

    <div class="input-group-wrapper">
        <div class="input-card labor">
            <div class="section-title" style="color:var(--labor-color)">å‹å·¥ä¿éšª (å‹ä¿)</div>
            <div class="form-group">
                <label>æœ€é«˜60å€‹æœˆå¹³å‡è–ªè³‡</label>
                <input type="number" id="laborSalary" value="45800" placeholder="ä¾‹å¦‚: 45800">
            </div>
            <div class="form-group">
                <label>ç›®å‰å‹ä¿å¹´è³‡ (å¹´)</label>
                <input type="number" id="laborYears" value="20" step="0.5">
            </div>
        </div>

        <div class="input-card national">
            <div class="section-title" style="color:var(--national-color)">åœ‹æ°‘å¹´é‡‘ (åœ‹ä¿)</div>
            <div class="form-group">
                <label>ç›®å‰åœ‹ä¿å¹´è³‡ (å¹´)</label>
                <input type="number" id="nationalYears" value="5" step="0.5" placeholder="ä¾‹å¦‚: 5">
            </div>
            <div class="form-group">
                <label>æœˆæŠ•ä¿é‡‘é¡ (å›ºå®š)</label>
                <input type="number" id="nationalSalary" value="19761" readonly style="background:#eee; color:#777;">
            </div>
        </div>

        <div class="input-card general">
            <div class="section-title">è«‹é ˜è¨­å®š</div>
            <div class="form-group">
                <label>é è¨ˆé–‹å§‹è«‹é ˜å¹´é½¡</label>
                <input type="number" id="targetAge" value="65" placeholder="æ³•å®šç‚º65æ­²">
            </div>
            <div class="form-group" style="font-size:0.8rem; color:#666;">
                *æ­¤è©¦ç®—å‡è¨­æ‚¨ç›®å‰æ­£åœ¨å·¥ä½œä¸­ (æŒçºŒç´¯ç©å‹ä¿å¹´è³‡)ï¼Œè€Œåœ‹ä¿å¹´è³‡æš«åœç´¯ç©ã€‚
            </div>
        </div>
    </div>

    <button class="btn" onclick="calculate()">é–‹å§‹åˆä½µè©¦ç®—</button>

    <div id="resultArea">
        <table id="resultTable">
            <thead>
                <tr>
                    <th class="th-info" rowspan="2">æƒ…å¢ƒ</th>
                    <th class="th-info" rowspan="2">è«‹é ˜<br>å¹´é½¡</th>
                    <th class="th-labor" colspan="2">å‹ä¿ (Bå¼)</th>
                    <th class="th-national" colspan="2">åœ‹ä¿ (Bå¼)</th>
                    <th class="th-total" rowspan="2">æ¯æœˆåˆè¨ˆ<br>é ˜å–é‡‘é¡</th>
                    <th class="th-total" rowspan="2">70æ­²<br>ç´¯ç©ç¸½é¡</th>
                    <th class="th-total" rowspan="2">75æ­²<br>ç´¯ç©ç¸½é¡</th>
                </tr>
                <tr>
                    <th class="th-labor" style="font-size:0.8em">å¹´è³‡</th>
                    <th class="th-labor" style="font-size:0.8em">é‡‘é¡</th>
                    <th class="th-national" style="font-size:0.8em">å¹´è³‡</th>
                    <th class="th-national" style="font-size:0.8em">é‡‘é¡</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>

        <div class="note">
            <strong>ğŸ’¡ è¨ˆç®—èªªæ˜ï¼š</strong><br>
            1. <strong>å…¬å¼é¸æ“‡</strong>ï¼šç•¶æ‚¨åŒæ™‚è«‹é ˜å‹ä¿å¹´é‡‘æ™‚ï¼Œåœ‹æ°‘å¹´é‡‘ä¾è¦å®šåƒ…èƒ½ä½¿ç”¨ <strong>Bå¼</strong> (æœˆæŠ•ä¿é‡‘é¡Ã—å¹´è³‡Ã—1.3%) è¨ˆç®—ï¼Œä¸èƒ½äº«æœ‰Aå¼çš„3,772å…ƒåŸºæœ¬ä¿éšœã€‚<br>
            2. <strong>å¢æ¸›çµ¦æ¯”ä¾‹</strong>ï¼šå‹ä¿èˆ‡åœ‹ä¿çš†æœ‰ææ—©/å»¶å¾Œæ©Ÿåˆ¶ (æ¯ä¸€å¹´Â±4%)ã€‚æ­¤è¡¨å‡è¨­æ‚¨åœ¨ã€Œé è¨ˆè«‹é ˜å¹´é½¡ã€åŒæ™‚å•Ÿå‹•å…©è€…çš„å¹´é‡‘çµ¦ä»˜ã€‚<br>
            3. <strong>æƒ…å¢ƒå‡è¨­</strong>ï¼šè¡¨æ ¼ä¸­çš„ã€Œå†ä¿ X å¹´ã€æ˜¯å‡è¨­æ‚¨ **æŒçºŒå¾äº‹å‹ä¿å·¥ä½œ**ã€‚å› æ­¤å‹ä¿å¹´è³‡æœƒå¢åŠ ï¼Œä½†åœ‹ä¿å¹´è³‡ç¶­æŒä¸è®Š (å› ç‚ºæœ‰å‹ä¿æ™‚ä¸ç”¨ç¹³åœ‹ä¿)ã€‚<br>
            4. <strong>åœ‹ä¿æŠ•ä¿é‡‘é¡</strong>ï¼šç›®å‰å›ºå®šç‚º 19,761 å…ƒ (éš¨ç‰©åƒ¹æŒ‡æ•¸èª¿æ•´ï¼Œæ­¤è™•æ¡ç¾è¡Œè²»ç‡)ã€‚
        </div>
    </div>
</div>

<script>
    const NATIONAL_INSURED_AMOUNT = 19761; // åœ‹ä¿æœˆæŠ•ä¿é‡‘é¡
    const STANDARD_RETIRE_AGE = 65;

    function formatMoney(num) {
        return new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', minimumFractionDigits: 0 }).format(num);
    }

    function calculate() {
        // 1. å–å¾—è¼¸å…¥å€¼
        const lSalary = parseFloat(document.getElementById('laborSalary').value);
        const lYearsStart = parseFloat(document.getElementById('laborYears').value);
        const nYearsStart = parseFloat(document.getElementById('nationalYears').value);
        const targetAge = parseFloat(document.getElementById('targetAge').value);

        if (isNaN(lSalary) || isNaN(lYearsStart) || isNaN(nYearsStart) || isNaN(targetAge)) {
            alert("è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼");
            return;
        }

        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = "";
        document.getElementById('resultArea').style.display = "block";

        // 2. å®šç¾©æƒ…å¢ƒï¼šç›®å‰, +1å¹´, +3å¹´, +5å¹´, +10å¹´
        const scenarios = [0, 1, 3, 5, 10];

        scenarios.forEach((addYears, index) => {
            const currentAge = targetAge + addYears; // å‡è¨­å¹´é½¡éš¨å·¥ä½œå¹´è³‡å¢åŠ 
            
            // --- å‹ä¿è¨ˆç®— ---
            // å‡è¨­æ–°å¢çš„å¹´è³‡éƒ½æ˜¯å‹ä¿ (æŒçºŒå·¥ä½œ)
            const finalLaborYears = lYearsStart + addYears;
            
            // å‹ä¿åŸºæœ¬é¡ (Bå¼è¼ƒå¸¸é©ç”¨æ–¼é•·æœŸå·¥ä½œè€…ï¼Œä¸”ç‚ºäº†èˆ‡åœ‹ä¿é‚è¼¯ä¸€è‡´ï¼Œæ­¤è™•Demoä»¥Bå¼ç‚ºä¸»ï¼Œå¯¦éš›ç³»çµ±æœƒæ“‡å„ª)
            // åš´è¬¹è¨ˆç®—æ‡‰åŒ…å«Aå¼ï¼Œä½†é¡¯ç¤ºæ¬„ä½æœ‰é™ï¼Œæ­¤è™•ä»¥ (è–ªè³‡ * å¹´è³‡ * 1.55%) ä¼°ç®—
            let lBase = lSalary * finalLaborYears * 0.0155;
            
            // è¨ˆç®—å‹ä¿ä¿‚æ•¸ (65æ­²åŸºæº–)
            let ageDiff = currentAge - STANDARD_RETIRE_AGE;
            // é™åˆ¶æœ€å¤šå¢æ¸›çµ¦ 20% (5å¹´)
            let effectiveDiff = Math.max(-5, Math.min(5, ageDiff));
            let lMultiplier = 1 + (effectiveDiff * 0.04);
            
            // å‹ä¿æœˆé ˜
            let lAmount = Math.round(lBase * lMultiplier);
            if (currentAge < 60) lAmount = 0; // å‹ä¿æœ€æ—©60æ­²(æ‰£20%)

            // --- åœ‹ä¿è¨ˆç®— ---
            // åœ‹ä¿å¹´è³‡ä¸è®Š (å› ç‚ºæ­£åœ¨åšå‹ä¿)
            const finalNationalYears = nYearsStart;
            
            // åœ‹ä¿åªèƒ½ç”¨ Bå¼ (æœˆæŠ•ä¿é‡‘é¡ * å¹´è³‡ * 1.3%) å› ç‚ºæœ‰å‹ä¿å¹´é‡‘
            let nBase = NATIONAL_INSURED_AMOUNT * finalNationalYears * 0.013;
            
            // åœ‹ä¿ä¿‚æ•¸ (65æ­²åŸºæº–ï¼Œè¦å‰‡èˆ‡å‹ä¿é¡ä¼¼)
            let nMultiplier = 1 + (effectiveDiff * 0.04);
            
            // åœ‹ä¿æœˆé ˜
            let nAmount = Math.round(nBase * nMultiplier);
            if (currentAge < 60) nAmount = 0; // åœ‹ä¿æœ€æ—©äº¦ç‚º60

            // --- ç¸½è¨ˆ ---
            let totalMonth = lAmount + nAmount;

            // --- çµ‚èº«ç´¯ç© ---
            // ç°¡å–®è¨ˆç®—ï¼š(70 - é–‹å§‹é ˜çš„å¹´é½¡) * 12 * æœˆé ˜
            let sum70 = 0;
            if (currentAge < 70) {
                sum70 = totalMonth * (70 - currentAge) * 12;
            }

            let sum75 = 0;
            if (currentAge < 75) {
                sum75 = totalMonth * (75 - currentAge) * 12;
            }

            // --- ç”¢ç”Ÿè¡¨æ ¼åˆ— ---
            const rowClass = index === 0 ? "highlight-row" : "";
            const label = addYears === 0 ? "ç›®å‰ç‹€æ…‹" : `å†å·¥ä½œ ${addYears} å¹´`;

            const html = `
                <tr class="${rowClass}">
                    <td>${label}</td>
                    <td>${currentAge} æ­²</td>
                    
                    <td class="labor-text">${finalLaborYears} å¹´</td>
                    <td class="money labor-text">${formatMoney(lAmount)}</td>
                    
                    <td class="national-text">${finalNationalYears} å¹´</td>
                    <td class="money national-text">${formatMoney(nAmount)}</td>
                    
                    <td class="money total-text">${formatMoney(totalMonth)}</td>
                    <td class="money">${formatMoney(sum70)}</td>
                    <td class="money">${formatMoney(sum75)}</td>
                </tr>
            `;
            tbody.innerHTML += html;
        });
    }
</script>

</body>
</html>