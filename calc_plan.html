<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éºç”¢ç¨…è¦åŠƒå·¥å…· (å«ä¼°åƒ¹æç¤ºç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --benefit-color: #27ae60;
            --loss-color: #c0392b;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --info-bg: #d1ecf1;
            --info-text: #0c5460;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
        }
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
            line-height: 1.5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        h2 { text-align: center; color: var(--primary-color); margin-top: 0; margin-bottom: 10px; }
        h3 {
            color: var(--secondary-color);
            border-left: 5px solid var(--accent-color);
            padding-left: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding-top: 5px; padding-bottom: 5px;
        }
        
        .form-group {
            margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
        }
        .form-group label { flex: 1; min-width: 200px; font-weight: 500; }
        .input-wrapper { flex: 1; display: flex; justify-content: flex-end; align-items: center; position: relative; }
        
        /* è¼¸å…¥æ¡†æ¨£å¼ */
        input[type="number"], select, input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 140px;
            text-align: right;
            font-size: 16px;
        }
        /* å–®ä½å¾Œç¶´ */
        .unit-suffix {
            margin-left: 5px;
            font-size: 0.9em;
            color: #7f8c8d;
            width: 30px;
        }
        
        /* å°ˆé–€çš„æ¬„ä½ä¸‹æ–¹æç¤ºæ–‡å­— */
        .field-hint-text {
            width: 100%;
            text-align: right;
            font-size: 0.85em;
            color: #2980b9; /* è—è‰²æç¤º */
            margin-top: 5px;
            font-weight: 500;
        }

        .checkbox-wrapper input { width: 20px; height: 20px; margin-right: 10px; }
        
        .info-box {
            background-color: var(--info-bg); color: var(--info-text); padding: 12px;
            border-radius: 6px; font-size: 0.9em; margin-bottom: 15px; border-left: 4px solid #17a2b8;
        }
        
        .result-box { background-color: #ecf0f1; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .money { font-family: monospace; font-weight: bold; }
        .final-tax { color: var(--loss-color); font-size: 1.4em; font-weight: bold; }

        .tax-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; margin-bottom: 15px; }
        .tax-table th, .tax-table td { border: 1px solid #ddd; padding: 6px; text-align: center; }
        .tax-table th { background-color: var(--primary-color); color: white; }
        .active-row { background-color: #fff3cd !important; border: 2px solid #e67e22; font-weight: bold; color: #d35400; }

        .plan-inputs {
            background-color: #eef2f3; padding: 20px; border-radius: 10px; margin-bottom: 20px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
        }
        .readonly-input { background-color: #e8e8e8; border: 1px solid #ccc; color: #555; cursor: not-allowed; }
        .auto-calc-tax {
            border: 2px solid var(--loss-color) !important;
            background-color: #fff0f0 !important;
            color: var(--loss-color) !important;
            font-weight: bold;
        }

        .comparison-container { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .card { flex: 1; padding: 20px; border-radius: 12px; border: 1px solid #eee; min-width: 280px; display: flex; flex-direction: column; }
        .card.left { background-color: #fff; border-top: 5px solid #95a5a6; }
        .card.right { background-color: #f9fff9; border-top: 5px solid var(--benefit-color); }
        .card-title { text-align: center; font-size: 1.2em; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        .highlight-row {
            background-color: #ffecec; padding: 8px; border-radius: 6px; margin-bottom: 10px;
            border-left: 3px solid var(--loss-color); display: flex; justify-content: space-between; align-items: center;
        }

        .summary-bar {
            background-color: var(--primary-color); color: white; padding: 20px;
            border-radius: 10px; text-align: center; margin-top: 20px;
        }
        .summary-value { font-size: 2em; font-weight: bold; color: #f1c40f; display: block; margin-top: 5px; }

        @media (max-width: 600px) {
            .plan-inputs { grid-template-columns: 1fr; }
            .comparison-container { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>å…¨æ–¹ä½éºç”¢ç¨…è¦åŠƒå·¥å…·</h2>
    
    <h3>ç¬¬ä¸€æ­¥ï¼šç¾æ³è¨­å®š (2025)</h3>
    <div class="info-box">
        <strong>ğŸ’¡ å–®ä½æç¤ºï¼š</strong>æ‰€æœ‰é‡‘é¡è¼¸å…¥æ¬„ä½çš†ç‚º <strong>ã€Œè¬å…ƒã€</strong>ã€‚<br>
        (ä¾‹å¦‚ï¼šè³‡ç”¢ 5,000 è¬ï¼Œè«‹è¼¸å…¥ 5000)
    </div>

    <div class="form-group">
        <label for="calc_assets">è¢«ç¹¼æ‰¿äººè³‡ç”¢ç¸½é¡</label>
        <div class="input-wrapper">
            <input type="number" id="calc_assets" placeholder="ä¾‹: 5000" oninput="updateAll()">
            <span class="unit-suffix">è¬å…ƒ</span>
        </div>
        <div class="field-hint-text">
            *è¨ˆç®—åŸºç¤ï¼šåœŸåœ°(å…¬å‘Šç¾å€¼)ã€æˆ¿å±‹(è©•å®šç¾å€¼)ã€è‚¡ç¥¨(æ”¶ç›¤åƒ¹)
        </div>
    </div>
    
    <div class="form-group">
        <label for="calc_gifts" style="color:#d35400;">æ­»äº¡å‰ 2 å¹´å…§è´ˆèˆ‡</label>
        <div class="input-wrapper">
            <input type="number" id="calc_gifts" placeholder="0" oninput="updateAll()">
            <span class="unit-suffix">è¬å…ƒ</span>
        </div>
    </div>
    
    <div class="form-group" style="margin-top:20px;">
        <label>æ˜¯å¦æœ‰é…å¶ (æ‰£ 553 è¬)</label>
        <div class="input-wrapper checkbox-wrapper">
            <input type="checkbox" id="calc_spouse" onchange="updateAll()"> 
            <span style="width:30px;">æ˜¯</span>
        </div>
    </div>
    <div class="form-group">
        <label>ç›´ç³»å‘è¦ªå±¬äººæ•¸ (æ¯äºº 56 è¬)</label>
        <div class="input-wrapper">
            <input type="number" id="calc_children" value="0" min="0" oninput="updateAll()">
            <span class="unit-suffix">äºº</span>
        </div>
    </div>
    <div class="form-group">
        <label>å—æ‰¶é¤Šçˆ¶æ¯äººæ•¸ (æ¯äºº 138 è¬)</label>
        <div class="input-wrapper">
            <input type="number" id="calc_parents" value="0" min="0" max="2" oninput="updateAll()">
            <span class="unit-suffix">äºº</span>
        </div>
    </div>
    <div class="form-group">
        <label>èº«å¿ƒéšœç¤™è¦ªå±¬äººæ•¸ (æ¯äºº 693 è¬)</label>
        <div class="input-wrapper">
            <input type="number" id="calc_disabled" value="0" min="0" oninput="updateAll()">
            <span class="unit-suffix">äºº</span>
        </div>
    </div>
    <div class="form-group">
        <label>å…¶ä»–æ‰£é™¤é¡/å‚µå‹™</label>
        <div class="input-wrapper">
            <input type="number" id="calc_other" value="0" oninput="updateAll()">
            <span class="unit-suffix">è¬å…ƒ</span>
        </div>
    </div>

    <div class="result-box">
        <div class="result-row">
            <span>éºç”¢ç¸½é¡ (å«2å¹´å…§è´ˆèˆ‡)ï¼š</span>
            <span class="money" id="res_grossEstate">0</span>
        </div>
        <div class="result-row">
            <span>æ‰£é™¤é¡+å…ç¨…é¡åˆè¨ˆï¼š</span>
            <span class="money" id="res_deductions">0</span>
        </div>
        <div class="result-row">
            <span>èª²ç¨…éºç”¢æ·¨é¡ï¼š</span>
            <span class="money" id="res_netEstate" style="color:#2980b9;">0</span>
        </div>
        <table class="tax-table">
            <thead>
                <tr><th width="50%">èª²ç¨…éºç”¢æ·¨é¡</th><th>ç¨…ç‡</th><th>ç´¯é€²å·®é¡</th></tr>
            </thead>
            <tbody>
                <tr id="bracket-1"><td>5,000 è¬ä»¥ä¸‹</td><td>10%</td><td>0</td></tr>
                <tr id="bracket-2"><td>5,000 è¬ ~ 1 å„„</td><td>15%</td><td>250 è¬</td></tr>
                <tr id="bracket-3"><td>è¶…é 1 å„„</td><td>20%</td><td>750 è¬</td></tr>
            </tbody>
        </table>
        <div class="result-row" style="border-top: 1px dashed #ccc; padding-top:10px;">
            <span style="font-size:1.2em; font-weight:bold;">ç›®å‰æ‡‰ç´éºç”¢ç¨…ï¼š</span>
            <span class="money final-tax" id="res_finalTax">0</span>
        </div>
    </div>

    <h3>ç¬¬äºŒæ­¥ï¼šè³‡ç”¢æ´»åŒ–æ•ˆç›Šåˆ†æ (ä¿éšªè¦åŠƒ)</h3>
    <div class="info-box" style="background-color: #e8f8f5; border-color: #27ae60; color: #1e8449;">
        <strong>ğŸš€ å…¨è‡ªå‹•è¨ˆç®—ï¼š</strong>è¼¸å…¥ä¿è²»(è¬å…ƒ)å¾Œï¼Œç³»çµ±å°‡è‡ªå‹•é‡ç®—ç¨…é¡ã€‚
    </div>
    
    <div class="plan-inputs">
        <div>
            <div class="form-group">
                <label>1. ç›®å‰è³‡ç”¢ç¸½é¡</label>
                <input type="text" id="plan_assets" class="readonly-input" readonly>
                </div>
            <div class="form-group">
                <label>2. ç›®å‰éºç”¢ç¨…</label>
                <input type="text" id="plan_oldTax" class="readonly-input" readonly>
            </div>
        </div>
        <div>
            <div class="form-group">
                <label style="color:var(--benefit-color);">3. è¦åŠƒä¿è²»æŠ•å…¥</label>
                <div class="input-wrapper">
                    <input type="number" id="plan_premium" placeholder="ä¾‹: 1000" oninput="updateAll()">
                    <span class="unit-suffix">è¬å…ƒ</span>
                </div>
            </div>
            <div class="form-group">
                <label style="color:var(--benefit-color);">4. ä¿éšªç†è³ é‡‘é¡</label>
                <div class="input-wrapper">
                    <input type="number" id="plan_coverage" placeholder="ä¾‹: 1100" oninput="updateAll()">
                    <span class="unit-suffix">è¬å…ƒ</span>
                </div>
            </div>
            <div class="form-group">
                <label style="color:var(--loss-color);">5. é™ä½è³‡ç”¢å¾Œéºç”¢ç¨…</label>
                <input type="text" id="plan_newTax" class="auto-calc-tax" readonly value="0">
            </div>
        </div>
    </div>

    <div class="comparison-container">
        <div class="card left">
            <div class="card-title">æ–¹æ¡ˆ Aï¼šç¶­æŒç¾ç‹€</div>
            <div class="result-row">
                <span>è³‡ç”¢ç¸½é¡ï¼š</span>
                <span id="disp_planA_assets">0</span>
            </div>
            <div class="highlight-row">
                <span>åŸæœ¬éºç”¢ç¨…ï¼š</span>
                <span style="color:var(--loss-color); font-weight:bold;" id="disp_planA_tax">0</span>
            </div>
            <div class="result-row" style="margin-top:auto; border-top:2px dashed #ccc; padding-top:10px;">
                <span style="font-size:1.1em; font-weight:bold;">å¯¦éš›ç¹¼æ‰¿é‡‘é¡</span>
            </div>
            <div style="text-align:right; font-size:1.4em; font-weight:bold; color:#2c3e50;" id="disp_planA_legacy">0</div>
        </div>

        <div class="card right">
            <div class="card-title">æ–¹æ¡ˆ Bï¼šä¿éšªè¦åŠƒ</div>
            <div class="result-row">
                <span>å‰©é¤˜æ‡‰ç¨…è³‡ç”¢ï¼š</span>
                <span id="disp_planB_assets">0</span>
            </div>
            <div class="highlight-row">
                <span>ğŸ”» é™ä½å¾Œéºç”¢ç¨…ï¼š</span>
                <span style="color:var(--loss-color); font-weight:bold;" id="disp_planB_tax">0</span>
            </div>
            <div class="result-row">
                <span>+ ä¿éšªç†è³  (å…ç¨…)ï¼š</span>
                <span style="color:var(--benefit-color); font-weight:bold;" id="disp_planB_coverage">0</span>
            </div>
            <div class="result-row" style="margin-top:auto; border-top:2px dashed #ccc; padding-top:10px;">
                <span style="font-size:1.1em; font-weight:bold;">å¯¦éš›ç¹¼æ‰¿é‡‘é¡</span>
            </div>
            <div style="text-align:right; font-size:1.4em; font-weight:bold; color:var(--benefit-color);" id="disp_planB_legacy">0</div>
        </div>
    </div>

    <div class="summary-bar">
        è¦åŠƒç¸½æ•ˆç›Š (å¤šç•™çµ¦å®¶äººçš„éŒ¢)
        <span class="summary-value" id="totalBenefit">+ 0</span>
    </div>
</div>

<script>
    // === è¨­å®š ===
    const CONSTANTS = {
        EXEMPTION: 13330000,
        SPOUSE: 5530000,
        CHILD: 560000,
        PARENT: 1380000,
        DISABILITY: 6930000,
        FUNERAL: 1380000
    };
    
    // å®šç¾©å–®ä½æ›ç®— (1è¬å…ƒ = 10000å…ƒ)
    const UNIT_WAN = 10000;

    function formatMoney(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function updateAll() {
        // 1. å–å¾— Part 1 è¼¸å…¥ (æ³¨æ„ï¼šé€™è£¡å°‡è¬å…ƒè½‰æ›ç‚ºå…ƒ)
        // input 5000 -> 5000 * 10000 = 50,000,000
        let assetsInput = parseFloat(document.getElementById('calc_assets').value) || 0;
        let assets = assetsInput * UNIT_WAN;
        
        let giftsInput = parseFloat(document.getElementById('calc_gifts').value) || 0;
        let gifts = giftsInput * UNIT_WAN;
        
        let totalGrossEstate = assets + gifts; // A. éºç”¢ç¸½é¡

        // 2. è¨ˆç®—æ‰£é™¤é¡
        let deductionSum = CONSTANTS.FUNERAL;
        if (document.getElementById('calc_spouse').checked) deductionSum += CONSTANTS.SPOUSE;
        deductionSum += (parseInt(document.getElementById('calc_children').value) || 0) * CONSTANTS.CHILD;
        deductionSum += (parseInt(document.getElementById('calc_parents').value) || 0) * CONSTANTS.PARENT;
        deductionSum += (parseInt(document.getElementById('calc_disabled').value) || 0) * CONSTANTS.DISABILITY;
        
        // å…¶ä»–æ‰£é™¤é¡ä¹Ÿæ˜¯è¬å…ƒå–®ä½
        let otherInput = parseFloat(document.getElementById('calc_other').value) || 0;
        deductionSum += (otherInput * UNIT_WAN);

        let totalDeductions = deductionSum + CONSTANTS.EXEMPTION; // B. å…ç¨…é¡+æ‰£é™¤é¡

        // 3. è¨ˆç®— ã€æ–¹æ¡ˆ Aã€‘ ç¨…é¡
        let netEstateA = totalGrossEstate - totalDeductions;
        if (netEstateA < 0) netEstateA = 0;
        let taxA = calculateTaxFromNet(netEstateA);

        // 4. æ›´æ–° Part 1 UI
        document.getElementById('res_grossEstate').innerText = formatMoney(totalGrossEstate);
        document.getElementById('res_deductions').innerText = formatMoney(totalDeductions);
        document.getElementById('res_netEstate').innerText = formatMoney(netEstateA);
        document.getElementById('res_finalTax').innerText = formatMoney(taxA);
        updateBracketHighlight(netEstateA, totalGrossEstate);

        // 5. å–å¾— Part 2 ä¿è²»èˆ‡ç†è³  (è¬å…ƒå–®ä½)
        let premiumInput = parseFloat(document.getElementById('plan_premium').value) || 0;
        let premium = premiumInput * UNIT_WAN;
        
        let coverageInput = parseFloat(document.getElementById('plan_coverage').value) || 0;
        let coverage = coverageInput * UNIT_WAN;

        // 6. è¨ˆç®— ã€æ–¹æ¡ˆ Bã€‘ ç¨…é¡ (è³‡ç”¢æ¬ç§»)
        let assetsB = totalGrossEstate - premium;
        let netEstateB = assetsB - totalDeductions;
        if (netEstateB < 0) netEstateB = 0;
        let taxB = calculateTaxFromNet(netEstateB);

        // 7. æ›´æ–° Part 2 UI
        document.getElementById('plan_assets').value = formatMoney(totalGrossEstate);
        document.getElementById('plan_oldTax').value = formatMoney(taxA);
        document.getElementById('plan_newTax').value = formatMoney(taxB);

        // ç¹¼æ‰¿é‡‘é¡è¨ˆç®—
        let legacyA = totalGrossEstate - taxA;
        let legacyB = (assetsB - taxB) + coverage;
        let benefit = legacyB - legacyA;

        // æ¯”è¼ƒå¡ç‰‡
        document.getElementById('disp_planA_assets').innerText = formatMoney(totalGrossEstate);
        document.getElementById('disp_planA_tax').innerText = "-" + formatMoney(taxA);
        document.getElementById('disp_planA_legacy').innerText = formatMoney(Math.round(legacyA));

        document.getElementById('disp_planB_assets').innerText = formatMoney(assetsB);
        document.getElementById('disp_planB_tax').innerText = "-" + formatMoney(taxB);
        document.getElementById('disp_planB_coverage').innerText = "+" + formatMoney(coverage);
        document.getElementById('disp_planB_legacy').innerText = formatMoney(Math.round(legacyB));

        let benefitEl = document.getElementById('totalBenefit');
        benefitEl.innerText = (benefit >= 0 ? "+" : "") + formatMoney(Math.round(benefit));
        benefitEl.style.color = benefit >= 0 ? "#f1c40f" : "#c0392b";
    }

    function calculateTaxFromNet(netEstate) {
        let tax = 0;
        if (netEstate <= 50000000) {
            tax = netEstate * 0.10;
        } else if (netEstate <= 100000000) {
            tax = (netEstate * 0.15) - 2500000;
        } else {
            tax = (netEstate * 0.20) - 7500000;
        }
        return Math.round(tax);
    }

    function updateBracketHighlight(netEstate, totalGrossEstate) {
        ['bracket-1', 'bracket-2', 'bracket-3'].forEach(id => document.getElementById(id).classList.remove('active-row'));
        
        if (netEstate <= 50000000) {
            if(totalGrossEstate > 0) document.getElementById('bracket-1').classList.add('active-row');
        } else if (netEstate <= 100000000) {
            document.getElementById('bracket-2').classList.add('active-row');
        } else {
            document.getElementById('bracket-3').classList.add('active-row');
        }
    }

    updateAll();
</script>

</body>
</html>