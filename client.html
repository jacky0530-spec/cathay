<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ¶è¯çµ¡è¨˜éŒ„ç³»çµ± (å«æ—¥æœŸ)</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f4f7f6;
        }

        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: #333;
        }

        .container {
            max-width: 1100px; /* ç¨å¾®åŠ å¯¬ä»¥å®¹ç´æ—¥æœŸæ¬„ä½ */
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
        }

        /* è¼¸å…¥å€å¡Šæ¨£å¼ */
        .input-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; /* æ”¹ç‚ºä¸‰æ¬„ */
            gap: 15px;
        }

        .full-width {
            grid-column: span 3;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* æ—¥æœŸæ¬„ä½ç‰¹åˆ¥æ¨£å¼ */
        input[type="date"] {
            background-color: #fff;
            cursor: pointer;
        }

        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button.delete-btn {
            background-color: #e74c3c;
            padding: 5px 10px;
            font-size: 14px;
        }

        button.delete-btn:hover {
            background-color: #c0392b;
        }

        /* æœå°‹å€å¡Š */
        .search-section {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid var(--accent-color);
            border-radius: 4px;
            font-size: 16px;
        }

        /* è¡¨æ ¼æ¨£å¼ */
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px; /* é˜²æ­¢æ‰‹æ©Ÿç‰ˆå¤ªæ“  */
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            white-space: nowrap; /* æ¨™é¡Œä¸æ›è¡Œ */
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .no-data {
            text-align: center;
            color: #777;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .full-width {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>å®¢æˆ¶è³‡æ–™ç®¡ç†ç³»çµ±</h1>

    <div class="input-card">
        <h3>æ–°å¢è³‡æ–™</h3>
        <div class="form-grid">
            <div>
                <label>ç´€éŒ„æ—¥æœŸ *</label>
                <input type="date" id="recordDate">
            </div>
            <div>
                <label>å§“å *</label>
                <input type="text" id="name" placeholder="è¼¸å…¥å§“å">
            </div>
            <div>
                <label>é›»è©± *</label>
                <input type="tel" id="phone" placeholder="è¼¸å…¥é›»è©±">
            </div>
            <div class="full-width">
                <label>åœ°å€</label>
                <input type="text" id="address" placeholder="è¼¸å…¥åœ°å€">
            </div>
            <div class="full-width">
                <label>å·¥ä½œç¶“æ­·</label>
                <textarea id="experience" rows="2" placeholder="ç°¡è¿°å·¥ä½œç¶“æ­·"></textarea>
            </div>
            <div class="full-width">
                <label>è¯çµ¡å…§å®¹ / å‚™è¨»</label>
                <textarea id="notes" rows="3" placeholder="è¨˜éŒ„è¯çµ¡äº‹é …..."></textarea>
            </div>
        </div>
        <button onclick="saveData()">å„²å­˜è³‡æ–™</button>
        <button onclick="exportData()" style="background-color: #27ae60; margin-left: 10px;">åŒ¯å‡º Excel (CSV)</button>
    </div>

    <div class="search-section">
        <input type="text" id="searchInput" class="search-input" placeholder="ğŸ” æœå°‹å§“åã€é›»è©±ã€åœ°å€æˆ–å‚™è¨»..." onkeyup="searchData()">
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th width="12%">æ—¥æœŸ</th>
                    <th width="10%">å§“å</th>
                    <th width="12%">é›»è©±</th>
                    <th width="20%">åœ°å€</th>
                    <th width="18%">å·¥ä½œç¶“æ­·</th>
                    <th width="20%">è¯çµ¡å…§å®¹</th>
                    <th width="8%">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
        <div id="noDataMsg" class="no-data" style="display:none;">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è³‡æ–™</div>
    </div>
</div>

<script>
    // åˆå§‹åŒ–ï¼šç•¶é é¢è¼‰å…¥æ™‚
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        setDefaultDate();
    });

    // è¨­å®šæ—¥æœŸæ¬„ä½é è¨­ç‚ºä»Šå¤©
    function setDefaultDate() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('recordDate').value = today;
    }

    // å„²å­˜è³‡æ–™åŠŸèƒ½
    function saveData() {
        const recordDate = document.getElementById('recordDate').value;
        const name = document.getElementById('name').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const address = document.getElementById('address').value.trim();
        const experience = document.getElementById('experience').value.trim();
        const notes = document.getElementById('notes').value.trim();

        if (!name || !phone || !recordDate) {
            alert('è«‹ç¢ºèªã€Œæ—¥æœŸã€ã€ã€Œå§“åã€èˆ‡ã€Œé›»è©±ã€çš†å·²å¡«å¯«ï¼');
            return;
        }

        const newRecord = {
            id: Date.now(), 
            recordDate, // æ‰‹å‹•é¸æ“‡çš„æ—¥æœŸ
            name,
            phone,
            address,
            experience,
            notes,
            createdDate: new Date().toLocaleString() // ç³»çµ±è‡ªå‹•è¨˜éŒ„çš„å»ºç«‹æ™‚é–“ï¼ˆå‚™ç”¨ï¼‰
        };

        // å–å¾—èˆŠè³‡æ–™
        let records = JSON.parse(localStorage.getItem('contactRecords')) || [];
        records.push(newRecord); 

        // å­˜å› LocalStorage
        localStorage.setItem('contactRecords', JSON.stringify(records));

        // æ¸…ç©ºè¼¸å…¥æ¡†ä½†ä¿ç•™æ—¥æœŸç‚ºä»Šå¤©
        document.getElementById('name').value = '';
        document.getElementById('phone').value = '';
        document.getElementById('address').value = '';
        document.getElementById('experience').value = '';
        document.getElementById('notes').value = '';
        setDefaultDate();

        // é‡æ–°è¼‰å…¥åˆ—è¡¨
        loadData();
        alert('è³‡æ–™å„²å­˜æˆåŠŸï¼');
    }

    // è®€å–ä¸¦é¡¯ç¤ºè³‡æ–™åŠŸèƒ½
    function loadData() {
        let records = JSON.parse(localStorage.getItem('contactRecords')) || [];
        renderTable(records);
    }

    // æ¸²æŸ“è¡¨æ ¼
    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        const noDataMsg = document.getElementById('noDataMsg');
        tbody.innerHTML = '';

        if (data.length === 0) {
            noDataMsg.style.display = 'block';
            return;
        } else {
            noDataMsg.style.display = 'none';
        }

        // æ’åºï¼šæ—¥æœŸæ–°çš„åœ¨ä¸Šé¢
        data.sort((a, b) => {
            // å¦‚æœæœ‰æ‰‹å‹•æ—¥æœŸç”¨æ‰‹å‹•æ—¥æœŸï¼Œæ²’æœ‰å‰‡ç”¨ID(æ™‚é–“æˆ³)
            const dateA = a.recordDate ? new Date(a.recordDate) : new Date(a.id);
            const dateB = b.recordDate ? new Date(b.recordDate) : new Date(b.id);
            return dateB - dateA;
        });

        data.forEach(record => {
            // ç›¸å®¹èˆŠè³‡æ–™ï¼šå¦‚æœèˆŠè³‡æ–™æ²’æœ‰ recordDateï¼Œå°±é¡¯ç¤ºå»ºç«‹æ™‚é–“çš„æ—¥æœŸéƒ¨åˆ†
            let displayDate = record.recordDate || (record.date ? record.date.split(' ')[0] : 'ç„¡æ—¥æœŸ');

            const row = `
                <tr>
                    <td>${displayDate}</td>
                    <td><strong>${record.name}</strong></td>
                    <td>${record.phone}</td>
                    <td>${record.address}</td>
                    <td>${record.experience}</td>
                    <td>${record.notes}</td>
                    <td>
                        <button class="delete-btn" onclick="deleteData(${record.id})">åˆªé™¤</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // æœå°‹åŠŸèƒ½
    function searchData() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        let records = JSON.parse(localStorage.getItem('contactRecords')) || [];

        const filteredRecords = records.filter(record => {
            // è™•ç†èˆŠè³‡æ–™å¯èƒ½æ²’æœ‰ recordDate çš„æƒ…æ³
            const rDate = record.recordDate || '';
            
            return (
                record.name.toLowerCase().includes(keyword) ||
                record.phone.includes(keyword) ||
                record.address.toLowerCase().includes(keyword) ||
                record.notes.toLowerCase().includes(keyword) ||
                rDate.includes(keyword) // ä¹Ÿå¯ä»¥æœå°‹æ—¥æœŸ
            );
        });

        renderTable(filteredRecords);
    }

    // åˆªé™¤åŠŸèƒ½
    function deleteData(id) {
        if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿ')) {
            let records = JSON.parse(localStorage.getItem('contactRecords')) || [];
            records = records.filter(record => record.id !== id);
            localStorage.setItem('contactRecords', JSON.stringify(records));
            
            const searchKeyword = document.getElementById('searchInput').value;
            if(searchKeyword) {
                searchData();
            } else {
                loadData();
            }
        }
    }

    // åŒ¯å‡ºåŠŸèƒ½ (CSV)
    function exportData() {
        let records = JSON.parse(localStorage.getItem('contactRecords')) || [];
        if(records.length === 0) {
            alert("æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º");
            return;
        }

        let csvContent = "\uFEFF";
        csvContent += "æ—¥æœŸ,å§“å,é›»è©±,åœ°å€,å·¥ä½œç¶“æ­·,è¯çµ¡å…§å®¹\n";

        records.forEach(function(row) {
            let cleanExp = row.experience ? row.experience.replace(/,/g, "ï¼Œ").replace(/\n/g, " ") : "";
            let cleanNotes = row.notes ? row.notes.replace(/,/g, "ï¼Œ").replace(/\n/g, " ") : "";
            let rDate = row.recordDate || (row.date ? row.date.split(' ')[0] : ""); // ç›¸å®¹èˆŠè³‡æ–™
            
            let rowStr = `${rDate},${row.name},${row.phone},${row.address},${cleanExp},${cleanNotes}`;
            csvContent += rowStr + "\n";
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        
        link.setAttribute("href", url);
        link.setAttribute("download", "å®¢æˆ¶è¯çµ¡è³‡æ–™.csv");
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>